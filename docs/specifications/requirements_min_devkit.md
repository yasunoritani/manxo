# Min-DevKit中心のMax-Claude Desktop連携プロジェクト要件定義書

> **ライセンス情報**: 本プロジェクトではMin-DevKit（MIT License）を使用しています。
> Copyright 2018, The Min-DevKit Authors. All rights reserved.
> https://github.com/Cycling74/min-devkit

## 1. プロジェクト概要

### 1.1 目的
Claude DesktopからMax環境を操作できるようにする。Min-DevKit（C++ベース）を介してClaude DesktopとMax/MSPの橋渡しを行い、AIによるMax環境の自動操作を実現する。ユーザーはClaude Desktopに指示を出すだけで、Maxパッチの作成・編集やサウンド処理を実行できるようになる。

### 1.2 背景
Claude DesktopのAIをMax環境制御に活用することで、音楽家やサウンドデザイナーの創造プロセスを拡張する。Min-DevKitを中心とした設計により、Max内部機能への直接アクセスと広範なMaxバージョン（7.xから8.x）での互換性を確保する。

### 1.3 実現機能
- C++ベースのMin-DevKit開発環境の構築 (Max 7.x/8.x互換)
- Claude DesktopからMax環境を操作するための通信基盤
- Max for Live（Ableton Live内）環境対応
- MCPプロトコルを用いたClaude DesktopとMin-DevKit間の通信
- AIによるパッチ作成、DSP操作のための操作API
- MinDevKit実装の正確性検証メカニズム
- ネイティブUIによるインターフェース
- Max 7-8向けオプション機能
- **SQL知識ベースによるMax/MSP情報の提供と検証**

## 2. 機能要件

### 2.1 基盤機能
- **Min-DevKit開発環境**: C++/CMakeベースの開発環境
- **Max APIアクセス**: Max内部APIへの直接アクセス
- **マルチスレッドステート管理**: 状態追跡
- **クロスプラットフォーム**: Mac/Windows対応
- **SQLデータベース連携**: Max/MSPとMinDevKitの知識ベース参照と検証

### 2.2 通信機能
- **OSCブリッジ（Min-DevKit/C++）**: 高性能OSC通信
  - UDP/TCPソケット通信
  - スレッドセーフなメッセージング
  - アドレスパターンマッチング
  - バッファ管理と型変換
- **Claude Desktop-Max通信**: Claude DesktopからMaxへの命令伝達
- **MCPサーバー連携**: Claude DesktopのMCP基盤との連携
- **メッセージング標準化**: 統一されたアドレスパターンとパラメータ形式
- **状態同期**: 重要なイベントと状態変更の通知
- **エラー処理**: エラーコードシステムと回復メカニズム
- **SQL問い合わせ機能**: OSC通信を通じたデータベースクエリの実行と結果検証

### 2.3 Max環境操作
- **パッチ操作**: Claude Desktopの指示に基づくパッチの作成、読み込み、保存、閉じる操作
- **オブジェクト操作**: AIの命令によるオブジェクトの作成、削除、接続、移動
- **パラメータ操作**: AIによる値の設定、取得、監視
- **DSP処理**: AIの指示に基づくオーディオ処理と信号チェーン操作

### 2.4 AIアシスト機能
- **パッチ構造検証**: 生成されたMaxパッチの論理的整合性検証
- **創造的解釈**: Claude Desktopからの音楽表現をMax実装に変換
- **パッチ生成**: Claude Desktopの指示からMaxパッチを自動生成
- **事前検証**: Max操作前の論理チェックとエラー予測
- **MCPツール実装**: Claude DesktopがMax操作を実行するためのツールセット
- **自然言語変換**: Claude Desktopからの指示をMaxパッチとして実現
- **最小限フィードバック**: 重要なエラーや状態変更のみを通知
- **知識ベース検索**: SQL問い合わせを通じたMax/MinDevKit情報の取得と検証

### 2.5 Min-DevKitとClaude Desktop連携
- **Min-DevKit APIとMCPの統合**:
  - Claude DesktopのMCPからMin-DevKit APIへの命令変換
  - Min-DevKitオブジェクトモデルとMCPツール定義の対応付け
  - Max操作のための抽象化レイヤー
- **コード検証レイヤー**:
  - 生成されたコードの構文と論理検証
  - オブジェクト接続の妥当性チェック
  - パフォーマンス最適化の提案
- **命令変換の最適化**:
  - Claude Desktopからの指示をMin-DevKit API呼び出しに変換
  - AIの出力をMaxパッチ操作に変換
  - コード検証と安全な実行
- **最小限フィードバック**:
  - 成功/失敗の基本的なステータスのみ
  - エラー発生時の具体的な問題箇所の特定
  - トラブルシューティング情報の提供

### 2.6 SQL知識ベース (強化版)
- **データベース構造**:
  - MaxオブジェクトとAPIリファレンス情報の格納
  - MinDevKit C++ APIドキュメント
  - オブジェクト間の適切な接続パターン
  - 一般的なエラーパターンと解決策
  - バージョン互換性情報
- **検証メカニズム**:
  - 生成されたコードのパターン検証
  - オブジェクト接続の論理検証
  - DSP理論に基づく音声処理の正確性チェック
  - パフォーマンス分析と最適化提案
- **LLM連携機能**:
  - 検索結果をLLMのコンテキストに統合
  - 適切な情報の選定とフォーマット
  - コード生成精度の向上支援

## 3. 非機能要件

### 3.1 パフォーマンス
- **低レイテンシ**: Claude DesktopからMax操作までのレイテンシ50ms以下
- **リソース効率**: メモリ使用量の最適化（50MB以下）
- **複雑なパッチ対応**: 大量のオブジェクトにも対応
- **マルチスレッド**: 並列処理による効率化
- **クエリ応答時間**: SQL問い合わせの90%を100ms以内に完了

### 3.2 信頼性
- **エラー検出**: 通信・操作エラーの事前検出と回避
- **セッション保存**: 状態のバックアップと復元
- **バージョン互換性**: 異なるMax/Claude Desktopバージョンへの対応
- **安定動作**: クラッシュ防止
- **データベース整合性**: 知識ベースの一貫性と正確性の維持

### 3.3 セキュリティ
- **データ保護**: ユーザーパッチとデータの保護
- **認証管理**: APIキーと認証情報の安全管理
- **入力検証**: Claude Desktopからの入力検証
- **SQLインジェクション対策**: 安全なクエリ処理の実装

### 3.4 ユーザビリティ
- **直感的インターフェース**: Claude DesktopからMax操作を簡単に行う
- **視覚的フィードバック**: Maxパッチ内での操作結果の視覚的表示
- **カスタマイズ**: ユーザー設定と環境適応
- **ドキュメント**: 支援情報
- **知識ベースの透明性**: 提供される情報源と精度の明示

## 4. 技術アーキテクチャ

### 4.1 4層アーキテクチャ
1. **インテリジェンスレイヤー**:
   - Claude Desktop連携とMCP通信
   - 命令解釈システム
   - 意図変換エンジン
   - **SQL知識ベース連携と検証**

2. **統合レイヤー**:
   - Min-DevKitオーケストレーター
   - 命令変換エンジン
   - MCP連携レイヤー
   - **コード検証メカニズム**
   - **データベースクエリ管理**

3. **実行レイヤー**:
   - Max内部APIアクセス
   - DSP処理とオブジェクト操作
   - マルチスレッドパラメータ制御

4. **インタラクションレイヤー**:
   - UIフレームワーク
   - 基本的なステータス表示
   - エラー表示

### 4.2 技術スタック
- **Min-DevKit**: C++17による拡張開発（Max 8.2まで対応）
- **Max for Live**: Ableton Live内のMax統合
- **oscpack**: OSC通信用C++ライブラリ
- **libwebsockets**: WebSocket通信用C++ライブラリ
- **CMake**: クロスプラットフォームビルドシステム
- **Max API**: 内部機能へのアクセス
- **MCPサーバー**: Claude DesktopのMCP基盤連携
- **OSC**: 高速通信
- **マルチスレッド**: 並列処理と同期制御
- **シリアライゼーション**: 状態保存
- **SQLite**: 軽量データベースエンジン
- **Node for Max**: Node.jsベースのMaxスクリプティング環境

## 5. 実装計画

### 5.1 フェーズ1: 基盤構築（1-2週間）
- Min-DevKit基盤構築とコア設計
- OSCブリッジコンポーネント実装
- 開発環境整備

### 5.2 フェーズ2: コア実装（3-4週間）
- Min-DevKit統合オーケストレーター実装
- 命令変換エンジン開発
- Claude Desktop/MCPサーバー連携インターフェース
- UIフレームワーク開発
- 外部連携機能拡張

### 5.3 フェーズ3: 拡張機能（5-8週間）
- 創造的インタープリター開発
- DSP処理エンジン開発
- レガシー機能との互換層実装
- **SQL知識ベースと検証レイヤーの構築**

### 5.4 フェーズ4: Max 7-8向け機能（0-2週間）
- max-claude-bridge連携機能開発（Max 7-8限定）
- 条件付きコンパイル対応
- Max 7-8特有機能活用

### 5.5 フェーズ5: 統合と最適化（8-10週間）
- Min-DevKit拡張システム設計
- テスト・検証フレームワーク
- パフォーマンス最適化
- 互換性テスト
- **検証レイヤーの拡充と精度改善**

## 6. テスト計画

### 6.1 単体テスト
- 各コンポーネントのC++単体テスト
- 機能別API検証
- ストレステスト
- **検証レイヤーのユニットテスト**

### 6.2 統合テスト
- レイヤー間連携テスト
- クロスプラットフォーム検証
- 長時間安定性テスト
- **SQL知識ベースと検証レイヤーの連携テスト**

### 6.3 ユーザビリティテスト
- 音楽家とサウンドデザイナーによる評価
- ワークフロー効率分析
- 操作性と視覚的フィードバック評価
- **知識ベース検証の効果測定**

## 7. ドキュメント計画

### 7.1 開発者ドキュメント
- API仕様
- アーキテクチャ解説
- 標準パターン
- **SQLデータベーススキーマと検証API**

### 7.2 ユーザードキュメント
- インストールと設定ガイド
- Claude DesktopからMaxを操作する方法
- トラブルシューティング
- **知識ベースと検証機能の活用方法**

### 7.3 チュートリアル
- ステップバイステップガイド
- サンプルプロジェクト
- 音楽ジャンル別テンプレート

## 8. 成功基準

### 8.1 パフォーマンス指標
- レイテンシ50ms以下
- メモリ使用量50MB以下
- CPU使用率10%以下
- **検証処理応答時間100ms以下**

### 8.2 品質指標
- エラー発生率0.1%以下
- クラッシュ率0.01%以下
- テストカバレッジ90%以上
- **知識ベース情報の正確性95%以上**

### 8.3 ユーザー指標
- タスク完了時間の30%削減
- ユーザー満足度スコア8/10以上
- 反復利用率90%以上
- **AI生成コードの品質向上率20%以上**

## 9. 用語集

| 用語 | 説明 |
|------|------|
| **Min-DevKit** | C++ベースのMax拡張開発キット |
| **MCP** | Claude DesktopとMin-DevKit間の通信プロトコル |
| **OSC** | 音楽・マルチメディア機器間の通信プロトコル |
| **DSP** | デジタル信号処理 |
| **パッチ** | Max環境での視覚的プログラミング単位 |
| **Maxオブジェクト** | Max環境内の機能ブロック |
| **SQL** | 構造化クエリ言語、データベース操作に使用 |
| **知識ベース** | 構造化された情報の集合体、本プロジェクトではMax/MSP情報 |
| **検証レイヤー** | 生成されたコードやパッチの正確性を検証する層 |

## 10. システム連携フロー図

```
+-------------------+      MCPプロトコル      +---------------+       C++/API呼び出し      +--------------+
| Claude Desktop    |------------------------>| Min-DevKit    |----------------------------->| Max/MSP環境   |
| (AIアシスタント)  |                         | (C++ブリッジ) |                             | (パッチ/DSP)  |
+-------------------+                         +---------------+                             +--------------+
        |                                            |                                             |
        |                                            |                                             |
        |        SQL問い合わせ/検証                  |          直接視覚的確認                     |
        |        +----------------------+            |          +---------------------------+      |
        |        |                      |            |          |                           |      |
        v        v                      |            v          |                           |      |
+-------------------+                   |     +---------------+ |                           |      |
| SQL知識ベース     |<------------------+---->| 検証レイヤー  |<-----------------------------      |
| (Maxオブジェクト  |  コード生成支援          | (論理/構文   |     実装検証                      |
|  API/接続パターン)|  検証結果返送            |  妥当性検証) |                                   |
+-------------------+                         +---------------+                                   |
```

## 11. システム要件

### 11.1 ハードウェア要件
- **CPU**: Intel Core i5 (8世代以降) または同等の性能
- **メモリ**: 8GB以上
- **ディスク**: 500MB以上の空き容量

### 11.2 ソフトウェア要件
- **Max対応バージョン**:
  - プライマリ: Max 7.x および Max 8.2まで
  - セカンダリ: Max 7-8.x（オプション機能）
- **OS**:
  - macOS: 10.13以上
  - Windows: Windows 10以上
- **開発環境**:
  - macOS: Xcode 10以上
  - Windows: Visual Studio 2017以上
  - CMake 3.19以上
- **Node.js**: 14.x以上 (Node for Max用)
- **SQLite**: 3.35以上

### 11.3 依存ライブラリ
- **Min-DevKit**: Max用C++開発キット (MIT)
- **oscpack**: OSC通信用C++ライブラリ (BSD-3-Clause)
- **sqlite3**: SQLiteデータベースライブラリ (Public Domain)
- **node-sqlite3**: Node.js用SQLiteバインディング (BSD-3-Clause)

## 12. 承認

本要件定義書は以下の関係者により承認されています：

- プロジェクトマネージャー: [氏名]
- 技術責任者: [氏名]
- 品質保証責任者: [氏名]
- クライアント担当者: [氏名]

承認日: 2025年3月29日
