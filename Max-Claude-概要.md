# Max-Claude パッチジェネレーター概要

## 目次
1. [プロジェクト概要](#プロジェクト概要)
2. [システム構成](#システム構成)
3. [Max/MSPパッチファイル構造](#maxmspパッチファイル構造)
4. [amxdファイルについて](#amxdファイルについて)
5. [パッチの共有方法](#パッチの共有方法)
6. [参考リンク](#参考リンク)

## プロジェクト概要

Max-Claude パッチジェネレーターは、自然言語の指示から直接Max/MSPパッチファイル(`.maxpat`)やMax for Liveデバイス(`.amxd`)を生成するAIシステムです。音楽制作者やサウンドデザイナーは、プログラミングの詳細な知識がなくても、自分のアイデアを言葉で表現するだけですぐに使えるMaxパッチを入手できます。

### 主な機能

- **自然言語→Maxパッチ変換**: 日常言語での説明から完全なMaxパッチを生成
- **Max for Live対応**: Ableton Live用のデバイス(`.amxd`)ファイル生成
- **AIによるパッチ設計**: 音楽理論やDSP知識に基づいた最適なパッチ構造の提案
- **SQL知識ベースによる支援**: 専門的な接続パターンと最適なオブジェクト選択
- **即時利用可能**: 生成されたパッチファイルはすぐにMaxまたはAbleton Liveで開いて使用可能

## システム構成

システムは以下の主要コンポーネントから構成されています：

1. **Claude Desktop**:
   - 自然言語処理を担当
   - ユーザーの音楽制作・サウンドデザインの指示を理解
   - SQL知識ベースと連携して最適な実装を決定

2. **MCP (Model Context Protocol)**:
   - Claude Desktopとパッチ生成システム間の通信を担当
   - ツール機能を通じてパッチ生成をトリガー
   - 双方向フィードバックを実現

3. **SQL知識ベース**:
   - Max/MSPオブジェクト情報（561種類）
   - 接続パターン（201パターン）
   - 検証ルール（105ルール）
   - 自然言語意図マッピング（160マッピング）

4. **パッチ生成エンジン**:
   - JSONベースのmaxpatファイルを直接生成
   - オブジェクト間の接続を適切に構築
   - UIレイアウトを最適化

## Max/MSPパッチファイル構造

Maxパッチ(`.maxpat`)とMax for Liveデバイス(`.amxd`)は基本的にJSON形式のテキストファイルです。パッチファイルには以下の要素が含まれます：

- オブジェクト定義（種類、位置、パラメータなど）
- オブジェクト間の接続情報
- UIエレメント（スライダー、ボタンなど）の定義
- パッチの全体設定（サイズ、表示オプションなど）

### パッチ生成プロセス

1. **ユーザーの意図理解**:
   - Claude Desktopがユーザーの自然言語指示を解析
   - 必要なオブジェクトと機能の特定

2. **SQL知識ベース問い合わせ**:
   - 必要なMax/MSPオブジェクトの検索
   - 適切な接続パターンの特定
   - パラメータ設定の最適値取得

3. **パッチ構造設計**:
   - 信号フローの論理的構成
   - オブジェクト間の接続設計
   - UIエレメントの配置計画

4. **JSONファイル生成**:
   - Max/MSPのJSON形式に変換
   - オブジェクトとパラメータの設定
   - 接続情報の生成

5. **レイアウト最適化**:
   - UIの使いやすさを考慮した配置
   - 視覚的なグルーピング
   - スケーリングと位置調整

## amxdファイルについて

`.amxd` (Max for Live)ファイルは基本的にJSONベースですが、特殊な構造を持っています：

- JSONフォーマットをベースにしているが、ファイル先頭と末尾にバイナリデータを含む
- テキストエディタで開くとJSON部分と「�」で表示されるバイナリ部分が確認できる
- バイナリ部分はメタデータやリソース、凍結されたデバイスの依存関係などを含む

### amxdファイルの操作

- **直接編集**: 技術的には可能だが、バイナリ部分の扱いが難しく推奨されない
- **編集方法**:
  - Max内で`.amxd`を開いて編集する（Max 7以降）
  - または`.maxpat`として作成してからMax for Liveで変換
- **差分表示ツール**:
  - [maxdiff](https://github.com/Ableton/maxdevtools/blob/main/maxdiff/README.md)のようなツールを使用してgitでの差分表示が可能
  - `awk '(NR>1)'`コマンドを使用してバイナリヘッダーを無視した差分表示も可能

## パッチの共有方法

Max/MSPパッチファイルは以下の方法で共有できます：

1. **テキスト形式での共有**:
   - パッチをテキスト形式（`.mxt`）として保存
   - パッチの一部またはすべてをコピーして電子メールやメッセージで共有

2. **圧縮形式**:
   - 「Edit」メニューから「Copy Compressed」を選択して圧縮テキスト形式でコピー
   - 受信者は「New From Clipboard」でパッチとして復元可能

3. **リポジトリでの管理**:
   - GitHub等でバージョン管理する場合、`.gitattributes`ファイルでdiff表示を設定可能
   - テキスト形式で保存することでメールやフォーラムでの共有が容易に

## 参考リンク

- [Cycling '74 - パッチのテキスト形式](https://docs.cycling74.com/legacy/max7/vignettes/text_patches)
- [Max for Live デバイスの共有](https://cycling74.com/forums/save-amxd-device-as-maxpat/replies/1)
- [gitでのamxdファイル差分表示設定](https://steinkamp.us/posts/2022-02-15-git-diff-amxd-max)
- [Max/MSPパッチの構造](https://github.com/akx/demxf)
- [SQLデータベースのMax/MSPオブジェクト情報](https://github.com/aklaswad/maxpat2svg)
